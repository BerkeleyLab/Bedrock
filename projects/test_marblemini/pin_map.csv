## Marble Mini meta-xdc file process with
##   python ../meta-xdc.py pin_map.csv > marblem_rgmii.xdc
## Implicit dependence on Marble.xdc generated from
##   git@github.com:BerkeleyLab/Marble.git

## First column is pin name listed in Marble.xdc
## Second column is pin name as needed by rgmii_hw_test.v

# RGMII Rx
RGMII_RX_CLK  RGMII_RX_CLK
RGMII_RX_DV   RGMII_RX_CTRL
RGMII_RXD0    {RGMII_RXD[0]}
RGMII_RXD1    {RGMII_RXD[1]}
RGMII_RXD2    {RGMII_RXD[2]}
RGMII_RXD3    {RGMII_RXD[3]}

# RGMII Tx
RGMII_TX_CLK  RGMII_TX_CLK
RGMII_TX_EN   RGMII_TX_CTRL
RGMII_TXD0    {RGMII_TXD[0]}
RGMII_TXD1    {RGMII_TXD[1]}
RGMII_TXD2    {RGMII_TXD[2]}
RGMII_TXD3    {RGMII_TXD[3]}

# QSPI Boot Flash
CFG_FCS    BOOT_CS_B
CFG_MOSI   BOOT_MOSI
CFG_DIN    BOOT_MISO
CFG_D02    CFG_D02

# Debugging LEDs, Pmod1 == J12
Pmod1_0    {LED[0]}
Pmod1_1    {LED[1]}
Pmod1_2    {LED[2]}
Pmod1_3    {LED[3]}
Pmod1_4    {LED[4]}
Pmod1_5    {LED[5]}
Pmod1_6    {LED[6]}
Pmod1_7    {LED[7]}

# MMC microcontroller for configuration - for real!
FPGA_SCK   SCLK
FPGA_SSEL  CSB
FPGA_MOSI  MOSI
FPGA_MISO  MISO
FPGA_INT   MMC_INT

# I2C, shared access with microcontroller
I2C_FPGA_SDA     TWI_SDA
I2C_FPGA_SCL     TWI_SCL
EXP_INT          TWI_INT
I2C_FPGA_SW_RST  TWI_RST

# White Rabbit DAC
WR_DAC_SCLK      WR_DAC_SCLK
WR_DAC_DIN       WR_DAC_DIN
WR_DAC1_SYNC     WR_DAC1_SYNC
WR_DAC2_SYNC     WR_DAC2_SYNC

# 125 MHz from White Rabbit comes in via MGTREFCLK;
# we should really turn on the GTP and use its TXOUTCLK.
# 20 MHz from Y3 is a poor substitute
CLK20_VCXO  SYSCLK_P

# Miscellaneous
PHY_RSTn   PHY_RSTN
VCXO_EN    VCXO_EN

# Zest Stuff
FMC2_LA_27_N    ZEST_PWR_EN
# FMC2_LA_27_P    ZEST_PWR_SYNC

# Literal output follows

# Truly special:
#   MGTREFCLK0 MGT_CLK_0 connected via C296+C297 to FPGA_REF_CLK1
#   125 MHz from U20 CDCM61004
set_property -dict {PACKAGE_PIN F6} [get_ports GTPREFCLK_P]
set_property -dict {PACKAGE_PIN E6} [get_ports GTPREFCLK_N]

# Special pin properties for RGMII
# Invalid to flag RGMII_RX_CLK as IOB TRUE
set_property IOB TRUE [get_ports {RGMII_RX_CTRL}]
set_property IOB TRUE [get_ports {RGMII_RXD*}]
set_property IOB TRUE [get_ports {RGMII_TX*}]
set_property SLEW FAST [get_ports {RGMII_TX*}]

# Bank 0 setup
set_property CFGBVS VCCO [current_design]
set_property CONFIG_VOLTAGE 3.3 [current_design]

# Clocks
create_clock -name sys_clk -period 50.00 [get_ports SYSCLK_P]
create_clock -period 8.00 -name rx_clk [get_ports RGMII_RX_CLK]
set_clock_groups -name async_clks -asynchronous \
  -group [get_clocks -include_generated_clocks sys_clk] \
  -group [get_clocks -include_generated_clocks rx_clk]
