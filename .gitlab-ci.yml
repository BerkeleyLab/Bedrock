dsp_test:
  before_script:
    - cd dsp && export PYTHONPATH=../build-tools/
  stage: test
  script:
    - make && make checks

digaree_test:
  before_script:
    - cd dsp/digaree
  stage: test
  script:
    - make

cmoc_test:
  before_script:
    - cd cmoc && export PYTHONPATH=../build-tools/
  stage: test
  script:
    - make && make checks

cordic_test:
  before_script:
    - cd cordic && make clean
  stage: test
  script:
    - make all

rtsim_test:
  before_script:
    - cd rtsim && make clean && make
  stage: test
  script:
    - make clean && make checks && make rtsim.dat

flake8:
  stage: build
  script:
   - find . -name "*.py" | xargs flake8

badger_test:
  image: verilator:latest
  before_script:
    - cd badger/tests && make clean
  stage: test
  script:
    - make && make Vrtefi_blob

peripheral_test:
  before_script:
    - cd peripheral_drivers/idelay_scanner
  stage: test
  script:
    - make

oscope_top:
  before_script:
    - cd projects/oscope/bmb7_cu && ls /non-free
  stage: deploy
  script:
    - XILINX_VIVADO=/non-free/Xilinx/Vivado/2018.1 PATH=$XILINX_VIVADO/bin:$PATH make oscope_top.bit
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
    expire_in: 1 week
    paths:
      - projects/oscope/bmb7_cu/oscope_top.bit

badger_ac701:
  stage: deploy
  script:
    - XILINX_VIVADO=/non-free/Xilinx/Vivado/2018.1 PATH=$XILINX_VIVADO/bin:$PATH && cd badger/tests && make ac701_rgmii_vtest.bit && xc3sprog -c jtaghs1_fast ac701_rgmii_vtest.bit && echo "So far, so good" && sleep 5 && python badger_lb_io.py show
