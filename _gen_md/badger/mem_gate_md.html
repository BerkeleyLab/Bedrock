<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>badger mem_gate &mdash; Bedrock  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="badger status" href="status_md.html" />
    <link rel="prev" title="doc README" href="doc/README_md.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Bedrock
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../general-docs.html">General Docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../general-docs.html#docs">Docs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../CONTRIBUTING_md.html">CONTRIBUTING</a></li>
<li class="toctree-l3"><a class="reference internal" href="README_md.html">badger README</a></li>
<li class="toctree-l3"><a class="reference internal" href="doc/README_md.html">doc README</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">badger mem_gate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lightweight-address-space-serialization">Lightweight Address Space Serialization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="status_md.html">badger status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../board_support/bmb7_kintex/README_md.html">bmb7_kintex README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../board_support/zest/README_md.html">zest README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/cdc_snitch_md.html">build-tools cdc_snitch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/makefile_md.html">build-tools makefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/newad_md.html">build-tools newad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsp/README_md.html">dsp README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga_family/xilinx/README_md.html">xilinx README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guidelines/rtl_guidelines_md.html">guidelines rtl_guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../localbus/README_md.html">localbus README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../localbus/jit_rad_md.html">localbus jit_rad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripheral_drivers/i2cbridge/README_md.html">i2cbridge README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripheral_drivers/idelay_scanner/README_md.html">idelay_scanner README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/common/README_md.html">common README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/comms_top/README_md.html">comms_top README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/oscope/bmb7_cu/README_md.html">bmb7_cu README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/oscope/marble_family/README_md.html">marble_family README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/test_marble_family/README_md.html">test_marble_family README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/test_marble_family/i2c/README_md.html">i2c README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rtsim/README_md.html">rtsim README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial_io/chitchat/README_md.html">chitchat README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial_io/chitchat/chitchat_txrx_wrap_md.html">chitchat chitchat_txrx_wrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/README_md.html">picorv32 README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/badger_lwip/README_md.html">badger_lwip README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/fv/README_md.html">fv README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/lb_bridge/README_md.html">lb_bridge README</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bedrock-modules.html">Bedrock Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtsim-module.html">RTSIM Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dsp-digaree-module.html">DSP Digaree Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Bedrock</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../general-docs.html">General Docs</a></li>
      <li class="breadcrumb-item active">badger mem_gate</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_gen_md/badger/mem_gate_md.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This documentation is a work in progress.
Expect to see errors and unfinished things.</p>
</div>
<section id="badger-mem-gate">
<span id="mem-gate"></span><h1>badger mem_gate<a class="headerlink" href="#badger-mem-gate" title="Permalink to this heading"></a></h1>
<section id="lightweight-address-space-serialization">
<h2>Lightweight Address Space Serialization<a class="headerlink" href="#lightweight-address-space-serialization" title="Permalink to this heading"></a></h2>
<p>LASS is an encoding of reads and writes to a traditional VME-like address space.
It is designed for transport over UDP, and has a coordinated set of features
that make it useful for data exchange between a commodity computer master and
an FPGA slave, with high throughput and controlled latency.</p>
<p>LASS is agnostic as to the details of the bus that is driven; it is suitable
for use with AXI, Wishbone, or the minimalist local bus in use by LBNL ATG.
The underlying bus configuration is fixed at 32 bits data, 24 bits of
word-address.  Byte access is not supported.  Of course, fewer address bits
and narrower data words can be accommodated with padding.</p>
<section id="packet-structure">
<h3>Packet structure<a class="headerlink" href="#packet-structure" title="Permalink to this heading"></a></h3>
<p>LASS packets are composed of a 64-bit transaction ID followed by a string of
consecutive transactions.</p>
<p>Two types of transactions are supported. A single-beat transaction where single read
or write bus cycles are encoded, and a more complex, block-transfer based, where a
burst of reads or writes to consecutive addresses are encoded in a more efficient
manner.</p>
<p>A single-beat transaction is encoded in 64 bits and is composed of command, address
and data fields. The diagram below shows how this transaction type can be used to
form a simple packet containing two single-beat read or write transactions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">63</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>                     <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>    <span class="n">Command</span>    <span class="o">|</span>                    <span class="n">Address</span> <span class="mi">0</span>                  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">0</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>    <span class="n">Command</span>    <span class="o">|</span>                    <span class="n">Address</span> <span class="mi">1</span>                  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">1</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> This and all other packet diagrams follow the convention used in RFC-791,
whereby bytes are shown as they are sent ‘on the wire’, i.e., network-byte-order.</p>
<p>The packet space consumed by a block-transfer transaction depends on how many data
beats are being read or written. At a minimum, this type of transaction can be encoded
in 96 bits and adds an additional command and a repetition-count field to the
single-beat transaction described previously. The additional command field is used
to signal that the transaction being decoded is of type ‘burst’. The following diagram
depicts the structure of a packet containing a single block-transfer transaction where
two beats of data are either read or written.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">63</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>                     <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>  <span class="n">Cmd</span> <span class="p">(</span><span class="n">Burst</span><span class="p">)</span>  <span class="o">|</span>                <span class="n">Repetition</span> <span class="n">Count</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>    <span class="n">Command</span>    <span class="o">|</span>                    <span class="n">Address</span> <span class="mi">0</span>                  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">0</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">1</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<p>Note that each transmitted packet can string together any combination of these two
transaction types, provided the maximum packet length is not exceeded (see section
on practical considerations). This can be useful when, e.g., a long array and the
status register indicating its validity must both be read, and splitting the operation
into two packets is not desirable. The diagram below shows how such a packet could
be structured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Transaction</span> <span class="n">ID</span> <span class="p">[</span><span class="mi">63</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>                     <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>    <span class="n">Command</span>    <span class="o">|</span>                    <span class="n">Address</span> <span class="mi">0</span>                  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">0</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>  <span class="n">Cmd</span> <span class="p">(</span><span class="n">Burst</span><span class="p">)</span>  <span class="o">|</span>                <span class="n">Repetition</span> <span class="n">Count</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>    <span class="n">Command</span>    <span class="o">|</span>                    <span class="n">Address</span> <span class="mi">1</span>                  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">1</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">2</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                           <span class="n">Data</span> <span class="mi">3</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="data-encoding">
<h3>Data encoding<a class="headerlink" href="#data-encoding" title="Permalink to this heading"></a></h3>
<p>For both transaction types, the bit-widths add up such that all transactions
start on a 32-bit boundary. Data encoding is big-endian, a.k.a. network byte order.</p>
<p>In order to preserve 32-bit boundaries, the Command and Repetition Count fields
are oversized in relation to the information they convey.</p>
<p>The 8-bit Command field carries a single 2-bit operation sub-field (OP), according to the
following encoding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">4</span>  <span class="mi">5</span>  <span class="mi">6</span>  <span class="mi">7</span>
<span class="o">+--+--+--+--+--+--+--+--+</span>
<span class="o">|</span> <span class="n">RSV</span> <span class="o">|</span> <span class="n">OP</span>  <span class="o">|</span>    <span class="n">RSV</span>    <span class="o">|</span>
<span class="o">+--+--+--+--+--+--+--+--+</span>

<span class="n">OP</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">]:</span>
   <span class="mi">2</span><span class="s1">&#39;b00 - Write</span>
   <span class="mi">2</span><span class="s1">&#39;b01 - Read</span>
   <span class="mi">2</span><span class="s1">&#39;b10 - Burst</span>
   <span class="mi">2</span><span class="s1">&#39;b11 - Reserved</span>
</pre></div>
</div>
<p>N.B.: Reserved bits should be set to 0 by software. Failing to do this may result
in undefined behavior, since they may be defined in some future revision. One valid
response from the FPGA is therefore to drop packets that have unused bits set.</p>
<p>The 24-bit Repetition Count field only uses 9 bits to encode the actual repetition count, as
shown below. Note that while the width of the COUNT sub-field places an upper bound on
the number of data beats that can be transferred in a single packet, typical UDP
packet sizes place additional restrictions on this number. These limitations are
outlined in the next section.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>            <span class="n">Reserved</span>         <span class="o">|</span>      <span class="n">COUNT</span>      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">COUNT</span> <span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">0</span><span class="p">]:</span>
   <span class="mi">9</span><span class="s1">&#39;d0 - Illegal</span>
   <span class="mi">9</span><span class="s1">&#39;d1 - 1 Beat</span>
   <span class="mi">9</span><span class="s1">&#39;d2 - 2 Beats</span>
   <span class="o">...</span>
   <span class="mi">9</span><span class="s1">&#39;dN - N Beats</span>
</pre></div>
</div>
</section>
<section id="practical-considerations">
<h3>Practical considerations<a class="headerlink" href="#practical-considerations" title="Permalink to this heading"></a></h3>
<p>A key design element of this protocol is that every reply packet has
the same structure and length as the corresponding request packet.
Read requests put padding in the place where results will be returned;
replies to write requests echo the data that was written.
This balance naturally avoids overloading the reply channel, at least
in the common case of wire or fiber Ethernet deployments, because they
are full-duplex with symmetric bandwidth.
In this context, the processing logic embedded in the FPGA
can guarantee it will reply to every request.</p>
<p>The 64-bit ID can be any value chosen by the host, and will simply be echoed
by the FPGA.  This gives the software an easy mechanism to match up received
packets with outstanding requests.</p>
<p>In a typical Ethernet environment with 1500 MTU, UDP packets can have a
maximum payload size of 1472 octets.  Accounting for the 64-bit ID, there
is space for a maximum of 183 single-beat transactions per packet.</p>
<p>Likewise, it is possible to fill a packet with a block-transfer transaction with
364 data words, thus setting a practical limit on the values that can be used in
the Repetition Count block.</p>
<p>Exceeding the Ethernet MTU will trigger fragmentation on the software side,
which both is theoretically undesirable, and practically not supported by
typical FPGA UDP/IP implementations.</p>
<p>Driver software should have the maximum packet size easily configurable,
to be adaptable to changes in MTU or additional protocol layering.
An authentication layer could reduce the available packet size by 16 octets.</p>
</section>
<section id="implementation-and-discussion">
<h3>Implementation and discussion<a class="headerlink" href="#implementation-and-discussion" title="Permalink to this heading"></a></h3>
<p>A subset of LASS, without the repeat-count feature, has been used at LBNL
since about 2010.  Its FPGA-side implementation was rewritten in 2018
(Packet Badger) to operate properly on high-traffic networks.
This new version gives stronger real-time guarantees, and responds correctly
to “simultaneous” requests from multiple hosts/masters.</p>
<p>For maximum compatibility with legacy software that might set unused control
bits to non-zero, the implementation in mem_gateway.v does <em>not</em> enable the
repeat count feature by default.  Engaging it requires setting the
enable_bursts parameter to 1.</p>
<p>This feature set is extremely similar to EtherBone, sharing much of the
motivation and boundary conditions.  LASS is a bit more granular, is limited
to 24-bit addresses instead of 32, and is not specialized for Wishbone.
It would be interesting if someone rewrote or ported the EtherBone code
base/protocol as a plug-in to Packet Badger.</p>
<p>It’s relatively easy to attach a simulated LASS FPGA-end to a real UDP port,
to exercise the combination of software and (virtual) hardware for debugging.
Packet Badger includes two demos of this setup, one using Verilator and one
using Icarus Verilog.</p>
<p>LASS as implemented on Packet Badger (including Ethernet/IP/UDP and other
features like ARP and ICMP echo, for attachment to a GMII PHY) occupies about
1100 LUTs of Xilinx Spartan-6 or 7-Series chips. [Comparison to EtherBone?]</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="doc/README_md.html" class="btn btn-neutral float-left" title="doc README" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="status_md.html" class="btn btn-neutral float-right" title="badger status" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, LBNL ATG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>