<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>localbus README &mdash; Bedrock  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="localbus jit_rad" href="jit_rad_md.html" />
    <link rel="prev" title="guidelines rtl_guidelines" href="../guidelines/rtl_guidelines_md.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Bedrock
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../general-docs.html">General Docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../general-docs.html#docs">Docs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../CONTRIBUTING_md.html">CONTRIBUTING</a></li>
<li class="toctree-l3"><a class="reference internal" href="../badger/README_md.html">badger README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../badger/doc/README_md.html">doc README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../badger/mem_gate_md.html">badger mem_gate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../badger/status_md.html">badger status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../board_support/bmb7_kintex/README_md.html">bmb7_kintex README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../board_support/zest/README_md.html">zest README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/cdc_snitch_md.html">build-tools cdc_snitch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/makefile_md.html">build-tools makefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build-tools/newad_md.html">build-tools newad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsp/README_md.html">dsp README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga_family/xilinx/README_md.html">xilinx README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guidelines/rtl_guidelines_md.html">guidelines rtl_guidelines</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">localbus README</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#localbus-support">Localbus support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="jit_rad_md.html">localbus jit_rad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripheral_drivers/i2cbridge/README_md.html">i2cbridge README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripheral_drivers/idelay_scanner/README_md.html">idelay_scanner README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/common/README_md.html">common README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/comms_top/README_md.html">comms_top README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/oscope/bmb7_cu/README_md.html">bmb7_cu README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/oscope/marble_family/README_md.html">marble_family README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/test_marble_family/README_md.html">test_marble_family README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/test_marble_family/i2c/README_md.html">i2c README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rtsim/README_md.html">rtsim README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial_io/chitchat/README_md.html">chitchat README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial_io/chitchat/chitchat_txrx_wrap_md.html">chitchat chitchat_txrx_wrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/README_md.html">picorv32 README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/badger_lwip/README_md.html">badger_lwip README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/fv/README_md.html">fv README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soc/picorv32/test/lb_bridge/README_md.html">lb_bridge README</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bedrock-modules.html">Bedrock Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtsim-module.html">RTSIM Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dsp-digaree-module.html">DSP Digaree Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Bedrock</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../general-docs.html">General Docs</a></li>
      <li class="breadcrumb-item active">localbus README</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_gen_md/localbus/README_md.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This documentation is a work in progress.
Expect to see errors and unfinished things.</p>
</div>
<section id="localbus-readme">
<span id="readme"></span><h1>localbus README<a class="headerlink" href="#localbus-readme" title="Permalink to this heading"></a></h1>
<section id="localbus-support">
<h2>Localbus support<a class="headerlink" href="#localbus-support" title="Permalink to this heading"></a></h2>
<p>Many bedrock components revolve around or depend on an on-chip
<a class="reference external" href="https://en.wikipedia.org/wiki/Local_bus">localbus</a>.
Specifically a stripped-down lightweight bus reminiscent
of a VME A24 bus.</p>
<p>In a given clock domain, expect</p>
<ul class="simple">
<li><p>24-bit address</p></li>
<li><p>32-bit write data</p></li>
<li><p>32-bit read data</p></li>
<li><p>strobe and read/write</p></li>
</ul>
<p>Unlike more exotic and complex busses like AXI and Wishbone,
we specifically reject any idea of wait states and handshake.
Our use case covers real-time on-chip communication,
where cycle counts are well-defined and set at configuration/synthesis
time, <em>not</em> run-time.</p>
<p>Components held here are</p>
<ul class="simple">
<li><p>Just In Time Readout Across Domains - <a class="reference external" href="jit_rad.md">jit_rad</a> for short.</p></li>
<li><p>localbus.vh, a helper for cycle-accurate bus simulations</p></li>
<li><p>gen_regmap.py</p></li>
<li><p>the much-maligned tgen, a general-purpose real-time write sequencer,
constructed as a localbus interposer;
has support in leep as assemble_tgen() and tgen_reg_sequence()</p></li>
</ul>
<p>As the jit_rad documentation explains, it’s easy to shift the <em>write</em>
side of a localbus to a different clock domain.  Throughput is not affected,
and the additional latency and jitter are typically irrelevant
compared to what goes on in the software and LASS host computer.
Here are the typical few lines of Verilog we use to accomplish this
clock domain shift (extracted from cmoc/cryomodule.v):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wire</span> <span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">clk1x_data</span><span class="p">;</span>
<span class="n">wire</span> <span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">clk1x_addr</span><span class="p">;</span>
<span class="n">wire</span> <span class="n">clk1x_write</span><span class="p">;</span>
<span class="o">//</span> <span class="n">Transfer</span> <span class="n">local</span> <span class="n">bus</span> <span class="n">to</span> <span class="n">clk1x</span> <span class="n">domain</span>
<span class="n">data_xdomain</span> <span class="c1">#(.size(32+17)) lb_to_1x(</span>
<span class="o">.</span><span class="n">clk_in</span><span class="p">(</span><span class="n">lb_clk</span><span class="p">),</span> <span class="o">.</span><span class="n">gate_in</span><span class="p">(</span><span class="n">lb_write</span><span class="p">),</span> <span class="o">.</span><span class="n">data_in</span><span class="p">({</span><span class="n">lb_addr</span><span class="p">,</span><span class="n">lb_data</span><span class="p">}),</span>
<span class="o">.</span><span class="n">clk_out</span><span class="p">(</span><span class="n">clk1x</span><span class="p">),</span> <span class="o">.</span><span class="n">gate_out</span><span class="p">(</span><span class="n">clk1x_write</span><span class="p">),</span> <span class="o">.</span><span class="n">data_out</span><span class="p">({</span><span class="n">clk1x_addr</span><span class="p">,</span><span class="n">clk1x_data</span><span class="p">}));</span>
</pre></div>
</div>
<p>Also see</p>
<ul class="simple">
<li><p><a class="reference external" href="../badger/doc/mem_gateway.svg">Memory gateway timing</a></p></li>
<li><p><a class="reference external" href="../badger/mem_gate.md">Lightweight Address Space Serialization</a></p></li>
<li><p>Bus controller for Packet Badger <a class="reference external" href="../badger/mem_gateway.v">mem_gateway.v</a></p></li>
<li><p>Bus controller for BMB7 and QF2-pre <a class="reference external" href="../board_support/bmb7_kintex/jxj_gate.v">jxj_gate.v</a></p></li>
<li><p><a class="reference external" href="../build-tools/newad.md">Newad</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../guidelines/rtl_guidelines_md.html" class="btn btn-neutral float-left" title="guidelines rtl_guidelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="jit_rad_md.html" class="btn btn-neutral float-right" title="localbus jit_rad" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, LBNL ATG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>