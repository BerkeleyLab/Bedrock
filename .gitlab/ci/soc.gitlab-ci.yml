soc_picorv32_test:
  before_script:
    - cd soc/picorv32/test
  stage: test
  script:
    - make

soc_picorv32_kc705:
  stage: synthesis
  before_script:
    - cd soc/picorv32/project/kc705 && echo $XILINXD_LICENSE_FILE
  script:
    - XILINXD_LICENSE_FILE=$XILINXD_LICENSE_FILE XILINX_VIVADO=/non-free/Xilinx/Vivado/2018.3 PATH=$XILINX_VIVADO/bin:$PATH make system_synth.bit
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
    expire_in: 1 week
    paths:
      - soc/picorv32/project/kc705/system_synth.bit

soc_picorv32_cmod_a7:
  stage: synthesis
  before_script:
    - cd soc/picorv32/project/cmod_a7
  script:
    - PATH=$XILINX_VIVADO/bin:$PATH make system_synth.bit
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
    expire_in: 1 week
    paths:
      - soc/picorv32/project/cmod_a7/system_synth.bit

soc_picorv32_cmod_a7_run:
  stage: program
  dependencies:
    - soc_picorv32_cmod_a7
  before_script:
    - cd soc/picorv32/project/cmod_a7
  script:
    - make system_config && python3 hw_test.py /dev/ttyUSB1

