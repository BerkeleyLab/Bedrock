rtsim_test:
  extends: .build-matrix
  image: $IMAGE
  before_script:
    - cd rtsim && make clean && make
  stage: test
  script:
    - make clean && make checks && make rtsim.dat

cmoc_test:
  extends: .build-matrix
  image: $IMAGE
  before_script:
    - cd cmoc && export PYTHONPATH=../build-tools/
  stage: test
  script:
    - make && make checks
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
    expire_in: 1 week
    paths:
      - cmoc/fdbk_core_plot.pdf

cmoc_top:
  extends: .build-matrix
  image: $IMAGE
  before_script:
    - cd projects/cmoc_top/marblemini && ls /non-free
  stage: synthesis
  script:
    - XILINX_VIVADO=$XILINX_VIVADO PATH=$XILINX_VIVADO/bin:$PATH make HARDWARE=${TARGET} cmoc_top.bit
  parallel:
    matrix:
      - TARGET: [marblemini, marble]
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
    expire_in: 1 week
    paths:
      - projects/cmoc_top/marblemini/cmoc_top.bit
